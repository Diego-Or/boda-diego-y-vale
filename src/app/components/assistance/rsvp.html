<section id="rsvp">
  <h2 class="section-title">{{ config().title }}</h2>
  <p class="section-subtitle">
    Por favor confirma antes del {{ formattedDeadline() }}
  </p>

  @if (isDeadlinePassed()) {
    <div class="deadline-alert">
      <p>‚ö†Ô∏è La fecha l√≠mite para confirmaciones ha pasado. Si necesitas confirmar tu asistencia, por favor cont√°ctanos directamente.</p>
    </div>
  }

  <form [formGroup]="rsvpForm" (ngSubmit)="onSubmit()" class="rsvp-form">

    <!-- Nombre completo -->
    <div class="form-group">
      <label for="nombre">Nombre completo *</label>
      <input
        type="text"
        id="nombre"
        formControlName="nombre"
        placeholder="Ingresa tu nombre completo"
        [class.error]="nombre?.invalid && nombre?.touched">
      @if (nombre?.invalid && nombre?.touched) {
        <span class="error-text">
          @if (nombre?.errors?.['required']) {
            El nombre es obligatorio
          }
          @if (nombre?.errors?.['minlength']) {
            El nombre debe tener al menos 3 caracteres
          }
        </span>
      }
    </div>

    <!-- Documento de identidad -->
    <div class="form-group">
      <label for="documento">Documento de identidad *</label>
      <input
        type="text"
        id="documento"
        formControlName="documento"
        placeholder="Ingresa tu n√∫mero de documento (solo n√∫meros)"
        [class.error]="documento?.invalid && documento?.touched">
      @if (documento?.invalid && documento?.touched) {
        <span class="error-text">
          @if (documento?.errors?.['required']) {
            El documento es obligatorio
          }
          @if (documento?.errors?.['pattern']) {
            El documento debe contener solo n√∫meros
          }
        </span>
      }
    </div>

    <!-- Checkbox de alergias -->
    <div class="form-group checkbox-group">
      <input
        type="checkbox"
        id="alergias"
        formControlName="alergias">
      <label for="alergias">Tengo alergias o restricciones adicionales</label>
    </div>

    <!-- Mensaje o comentario -->
    <div class="form-group">
      <label for="mensaje">Mensaje o comentario (opcional)</label>
      <textarea
        id="mensaje"
        formControlName="mensaje"
        rows="4"
        placeholder="Escribe aqu√≠ tus comentarios o especifica alergias..."></textarea>
    </div>

    <!-- Mensaje de error general -->
    @if (errorMessage()) {
      <div class="error-message">
        {{ errorMessage() }}
      </div>
    }

    <!-- Bot√≥n de env√≠o -->
    <button
      type="submit"
      class="submit-btn"
      [class.loading]="isLoading()"
      [disabled]="isLoading() || isDeadlinePassed()">
      @if (isLoading()) {
        Guardando...
      } @else {
        Confirmar Asistencia
      }
    </button>

    <!-- Bot√≥n de descarga -->
    <button
      type="button"
      class="submit-btn secondary-btn"
      (click)="descargarExcel()">
      üìä Descargar Lista de Confirmaciones ({{ confirmacionesCount() }})
    </button>

    <!-- Mensaje de √©xito -->
    @if (showSuccessMessage()) {
      <div class="success-message">
        ¬°Gracias por confirmar! Nos emociona celebrar contigo üéâ
      </div>
    }
  </form>
</section>
